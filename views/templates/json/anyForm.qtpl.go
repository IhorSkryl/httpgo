// This file is automatically generated by qtc from "anyForm.qtpl".
// See https://github.com/valyala/quicktemplate for details.

//line anyForm.qtpl:1
package json

//line anyForm.qtpl:1
import (
	qtio422016 "io"

	qt422016 "github.com/valyala/quicktemplate"
)

// Copyright 2017 Author: Ruslan Bikchentaev. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.
//

//line anyForm.qtpl:5
import (
	"github.com/ruslanBik4/httpgo/views/templates/forms"
	"strings"
)

//line anyForm.qtpl:9
var (
	_ = qtio422016.Copy
	_ = qt422016.AcquireByteBuffer
)

//line anyForm.qtpl:10
type FormStructure struct {
	Action   string
	ClassCSS string
	IdCSS    string
	Events   map[string]string
}

// Формируем JSON, который затем будет использован в форме на клиенте
// dataJson и содержимое AddJson вставляются КАК ЕСТЬ, ПОТОМУ ЧТО БЫЛИ ОБРАБОТАНЫ РАНЕЕ!!!

//line anyForm.qtpl:21
func (thisForm *FormStructure) StreamJSONAnyForm(qw422016 *qt422016.Writer, ns *forms.FieldsTable, AddJson map[string]string) {
	//line anyForm.qtpl:23
	thisForm.setFormDefaults(ns)
	var onload string
	if _, ok := ns.SaveFormEvents["errorFunction"]; !ok {
		ns.SaveFormEvents["errorFunction"] = ""
	}

	if str, ok := ns.DataJSOM["onload"]; ok {
		onload = str.(string)
	} else {
		onload = ""
	}

	//line anyForm.qtpl:34
	qw422016.N().S(`{"fields": {`)
	//line anyForm.qtpl:37
	for _, field := range ns.Rows {
		//line anyForm.qtpl:39
		titleFull, titleLabel, placeholder, pattern, dataJson := field.GetColumnTitles()
		typeInput := field.TypeInput()

		//line anyForm.qtpl:41
		qw422016.N().S(`"`)
		//line anyForm.qtpl:42
		qw422016.E().S(field.COLUMN_NAME)
		//line anyForm.qtpl:42
		qw422016.N().S(`": {`)
		//line anyForm.qtpl:43
		if field.IS_NULLABLE == "NO" {
			//line anyForm.qtpl:43
			qw422016.N().S(`"required": true,`)
			//line anyForm.qtpl:43
		}
		//line anyForm.qtpl:44
		if titleFull > "" {
			//line anyForm.qtpl:44
			qw422016.N().S(`"title": "`)
			//line anyForm.qtpl:44
			qw422016.E().J(titleFull)
			//line anyForm.qtpl:44
			qw422016.N().S(`",`)
			//line anyForm.qtpl:44
		}
		//line anyForm.qtpl:45
		if titleLabel > "" {
			//line anyForm.qtpl:45
			qw422016.N().S(`"label": "`)
			//line anyForm.qtpl:45
			qw422016.E().J(titleLabel)
			//line anyForm.qtpl:45
			qw422016.N().S(`",`)
			//line anyForm.qtpl:45
		}
		//line anyForm.qtpl:46
		if placeholder > "" {
			//line anyForm.qtpl:46
			qw422016.N().S(`"placeholder": "`)
			//line anyForm.qtpl:46
			qw422016.E().S(placeholder)
			//line anyForm.qtpl:46
			qw422016.N().S(`",`)
			//line anyForm.qtpl:46
		}
		//line anyForm.qtpl:47
		if pattern > "" {
			//line anyForm.qtpl:47
			qw422016.N().S(`"pattern": "`)
			//line anyForm.qtpl:47
			qw422016.E().J(pattern)
			//line anyForm.qtpl:47
			qw422016.N().S(`",`)
			//line anyForm.qtpl:47
		}
		//line anyForm.qtpl:48
		if dataJson > "" {
			//line anyForm.qtpl:48
			qw422016.N().S(dataJson)
			//line anyForm.qtpl:48
			qw422016.N().S(`,`)
			//line anyForm.qtpl:48
		}
		//line anyForm.qtpl:49
		if field.Value > "" {
			//line anyForm.qtpl:49
			qw422016.N().S(`"value": "`)
			//line anyForm.qtpl:49
			qw422016.E().S(field.Value)
			//line anyForm.qtpl:49
			qw422016.N().S(`",`)
			//line anyForm.qtpl:49
		}
		//line anyForm.qtpl:50
		if field.CSSClass > "" {
			//line anyForm.qtpl:50
			qw422016.N().S(`"CSSClass": "`)
			//line anyForm.qtpl:50
			qw422016.E().S(field.CSSClass)
			//line anyForm.qtpl:50
			qw422016.N().S(`",`)
			//line anyForm.qtpl:50
		}
		//line anyForm.qtpl:51
		if field.CSSStyle > "" {
			//line anyForm.qtpl:51
			qw422016.N().S(`"CSSStyle": "`)
			//line anyForm.qtpl:51
			qw422016.E().S(field.CSSStyle)
			//line anyForm.qtpl:51
			qw422016.N().S(`",`)
			//line anyForm.qtpl:51
		}
		//line anyForm.qtpl:52
		if field.Figure > "" {
			//line anyForm.qtpl:52
			qw422016.N().S(`"Figure": "`)
			//line anyForm.qtpl:52
			qw422016.E().S(field.Figure)
			//line anyForm.qtpl:52
			qw422016.N().S(`",`)
			//line anyForm.qtpl:52
		}
		//line anyForm.qtpl:53
		if field.CHARACTER_MAXIMUM_LENGTH > 0 {
			//line anyForm.qtpl:53
			qw422016.N().S(`"maxlength":`)
			//line anyForm.qtpl:53
			qw422016.N().D(field.CHARACTER_MAXIMUM_LENGTH)
			//line anyForm.qtpl:53
			qw422016.N().S(`,`)
			//line anyForm.qtpl:53
		}
		//line anyForm.qtpl:54
		if strings.Contains(field.COLUMN_TYPE, "unsigned") {
			//line anyForm.qtpl:54
			qw422016.N().S(`"min":0,`)
			//line anyForm.qtpl:54
		}
		//line anyForm.qtpl:55
		if field.MinDate > "" {
			//line anyForm.qtpl:55
			qw422016.N().S(`"minDate": "`)
			//line anyForm.qtpl:55
			qw422016.E().S(field.MinDate)
			//line anyForm.qtpl:55
			qw422016.N().S(`",`)
			//line anyForm.qtpl:55
		}
		//line anyForm.qtpl:56
		if field.MaxDate > "" {
			//line anyForm.qtpl:56
			qw422016.N().S(`"maxDate": "`)
			//line anyForm.qtpl:56
			qw422016.E().S(field.MaxDate)
			//line anyForm.qtpl:56
			qw422016.N().S(`",`)
			//line anyForm.qtpl:56
		}
		//line anyForm.qtpl:57
		if len(field.Events) > 0 {
			//line anyForm.qtpl:57
			qw422016.N().S(`"Events": {`)
			//line anyForm.qtpl:59
			for name, funcName := range field.Events {
				//line anyForm.qtpl:59
				qw422016.N().S(`"`)
				//line anyForm.qtpl:60
				qw422016.E().S(name)
				//line anyForm.qtpl:60
				qw422016.N().S(`": "`)
				//line anyForm.qtpl:60
				qw422016.E().S(funcName)
				//line anyForm.qtpl:60
				qw422016.N().S(`",`)
				//line anyForm.qtpl:61
			}
			//line anyForm.qtpl:61
			qw422016.N().S(`"count":`)
			//line anyForm.qtpl:62
			qw422016.N().D(len(field.Events))
			//line anyForm.qtpl:62
			qw422016.N().S(`},`)
			//line anyForm.qtpl:64
		}
		//line anyForm.qtpl:65
		if len(field.EnumValues) > 0 {
			//line anyForm.qtpl:65
			qw422016.N().S(`"EnumValues": [`)
			//line anyForm.qtpl:66
			for i, val := range field.EnumValues {
				//line anyForm.qtpl:66
				if i > 0 {
					//line anyForm.qtpl:66
					qw422016.N().S(`,`)
					//line anyForm.qtpl:66
				}
				//line anyForm.qtpl:66
				qw422016.N().S(`"`)
				//line anyForm.qtpl:66
				qw422016.E().S(val)
				//line anyForm.qtpl:66
				qw422016.N().S(`"`)
				//line anyForm.qtpl:66
			}
			//line anyForm.qtpl:66
			qw422016.N().S(`],`)
			//line anyForm.qtpl:67
		}
		//line anyForm.qtpl:68
		if field.COLUMN_DEFAULT > "" {
			//line anyForm.qtpl:68
			qw422016.N().S(`"COLUMN_DEFAULT": "`)
			//line anyForm.qtpl:68
			qw422016.E().S(field.COLUMN_DEFAULT)
			//line anyForm.qtpl:68
			qw422016.N().S(`",`)
			//line anyForm.qtpl:68
		}
		//line anyForm.qtpl:69
		if field.CHARACTER_SET_NAME > "" {
			//line anyForm.qtpl:69
			qw422016.N().S(`"CHARACTER_SET_NAME": "`)
			//line anyForm.qtpl:69
			qw422016.E().S(field.CHARACTER_SET_NAME)
			//line anyForm.qtpl:69
			qw422016.N().S(`",`)
			//line anyForm.qtpl:69
		}
		//line anyForm.qtpl:69
		qw422016.N().S(`"type": "`)
		//line anyForm.qtpl:70
		qw422016.E().S(typeInput)
		//line anyForm.qtpl:70
		qw422016.N().S(`"},`)
		//line anyForm.qtpl:72
	}
	//line anyForm.qtpl:72
	qw422016.N().S(`"count":`)
	//line anyForm.qtpl:73
	qw422016.N().D(len(ns.Rows))
	//line anyForm.qtpl:73
	qw422016.N().S(`}, "form": { "onsubmit": "return saveForm(this,`)
	//line anyForm.qtpl:74
	qw422016.N().S(thisForm.Events[`successSaveForm`])
	//line anyForm.qtpl:74
	qw422016.N().S(`);","action" : "`)
	//line anyForm.qtpl:75
	qw422016.N().S(thisForm.Action)
	//line anyForm.qtpl:75
	qw422016.N().S(`","class" : "`)
	//line anyForm.qtpl:76
	qw422016.N().S(thisForm.ClassCSS)
	//line anyForm.qtpl:76
	qw422016.N().S(`","id" : "`)
	//line anyForm.qtpl:77
	qw422016.N().S(thisForm.IdCSS)
	//line anyForm.qtpl:77
	qw422016.N().S(`",`)
	//line anyForm.qtpl:78
	if onload != "" {
		//line anyForm.qtpl:78
		qw422016.N().S(`"onload": "`)
		//line anyForm.qtpl:78
		qw422016.N().S(onload)
		//line anyForm.qtpl:78
		qw422016.N().S(`",`)
		//line anyForm.qtpl:78
	}
	//line anyForm.qtpl:79
	if ns.Name > "" {
		//line anyForm.qtpl:79
		qw422016.N().S(`"name": "`)
		//line anyForm.qtpl:79
		qw422016.N().S(ns.Name)
		//line anyForm.qtpl:79
		qw422016.N().S(`",`)
		//line anyForm.qtpl:79
	}
	//line anyForm.qtpl:79
	qw422016.N().S(`"oninput": "formInput(this);", "onreset": "formReset(this);"}`)
	//line anyForm.qtpl:82
	for name, val := range AddJson {
		//line anyForm.qtpl:82
		qw422016.N().S(`,"`)
		//line anyForm.qtpl:83
		qw422016.E().S(name)
		//line anyForm.qtpl:83
		qw422016.N().S(`":`)
		//line anyForm.qtpl:83
		qw422016.N().S(val)
		//line anyForm.qtpl:84
	}
	//line anyForm.qtpl:84
	qw422016.N().S(`}`)
//line anyForm.qtpl:87
}

//line anyForm.qtpl:87
func (thisForm *FormStructure) WriteJSONAnyForm(qq422016 qtio422016.Writer, ns *forms.FieldsTable, AddJson map[string]string) {
	//line anyForm.qtpl:87
	qw422016 := qt422016.AcquireWriter(qq422016)
	//line anyForm.qtpl:87
	thisForm.StreamJSONAnyForm(qw422016, ns, AddJson)
	//line anyForm.qtpl:87
	qt422016.ReleaseWriter(qw422016)
//line anyForm.qtpl:87
}

//line anyForm.qtpl:87
func (thisForm *FormStructure) JSONAnyForm(ns *forms.FieldsTable, AddJson map[string]string) string {
	//line anyForm.qtpl:87
	qb422016 := qt422016.AcquireByteBuffer()
	//line anyForm.qtpl:87
	thisForm.WriteJSONAnyForm(qb422016, ns, AddJson)
	//line anyForm.qtpl:87
	qs422016 := string(qb422016.B)
	//line anyForm.qtpl:87
	qt422016.ReleaseByteBuffer(qb422016)
	//line anyForm.qtpl:87
	return qs422016
//line anyForm.qtpl:87
}

//line anyForm.qtpl:88
func (thisForm *FormStructure) streamsetFormDefaults(qw422016 *qt422016.Writer, ns *forms.FieldsTable) {
	//line anyForm.qtpl:90
	if thisForm.Action == "" {
		thisForm.Action = "/admin/exec/"
	}
	if thisForm.Events != nil {

		if _, ok := thisForm.Events["successSaveForm"]; !ok {

			if ns.SaveFormEvents != nil {
				if val, ok1 := ns.SaveFormEvents["successSaveForm"]; ok1 {
					thisForm.Events["successSaveForm"] = val
				}
			} else {
				thisForm.Events["successSaveForm"] = "afterSaveAnyForm"
			}
		}
	} else {

		thisForm.Events = make(map[string]string, 0)
		if ns.SaveFormEvents != nil {
			if val, ok := ns.SaveFormEvents["successSaveForm"]; ok {
				thisForm.Events["successSaveForm"] = val
			}
		} else {
			thisForm.Events["successSaveForm"] = "afterSaveAnyForm"
		}
	}

//line anyForm.qtpl:117
}

//line anyForm.qtpl:117
func (thisForm *FormStructure) writesetFormDefaults(qq422016 qtio422016.Writer, ns *forms.FieldsTable) {
	//line anyForm.qtpl:117
	qw422016 := qt422016.AcquireWriter(qq422016)
	//line anyForm.qtpl:117
	thisForm.streamsetFormDefaults(qw422016, ns)
	//line anyForm.qtpl:117
	qt422016.ReleaseWriter(qw422016)
//line anyForm.qtpl:117
}

//line anyForm.qtpl:117
func (thisForm *FormStructure) setFormDefaults(ns *forms.FieldsTable) string {
	//line anyForm.qtpl:117
	qb422016 := qt422016.AcquireByteBuffer()
	//line anyForm.qtpl:117
	thisForm.writesetFormDefaults(qb422016, ns)
	//line anyForm.qtpl:117
	qs422016 := string(qb422016.B)
	//line anyForm.qtpl:117
	qt422016.ReleaseByteBuffer(qb422016)
	//line anyForm.qtpl:117
	return qs422016
//line anyForm.qtpl:117
}
